<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.partyboard.applicant">

  <resultMap id="ApplicantMap" type="com.myspring.vampir.partyboard.vo.PartyApplicantVO">
    <id     property="id"        column="id"/>
    <result property="postId"    column="post_id"/>
    <result property="userId"    column="user_id"/>
    <result property="nick"      column="nick"/>
    <result property="status"    column="status"/>
    <result property="createdAt" column="created_at"/>
  </resultMap>

  <select id="list" parameterType="long" resultMap="ApplicantMap">
    SELECT id, post_id, user_id, nick, status, created_at
    FROM party_applicants
    WHERE post_id = #{value}
    ORDER BY id DESC
  </select>

  <insert id="insert" parameterType="map" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO party_applicants (post_id, user_id, nick, status)
    VALUES (#{postId}, #{userId}, #{nick}, 'APPLIED')
  </insert>

  <update id="updateStatus" parameterType="map">
    UPDATE party_applicants
    SET status = #{status}
    WHERE post_id = #{postId}
      AND user_id = #{userId}
  </update>

</mapper>
