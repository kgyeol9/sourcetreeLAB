<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.member">

  <!-- 결과 매핑: DB 컬럼 → VO 프로퍼티 -->
  <resultMap id="memResult"
             type="com.myspring.vampir.member.vo.MemberVO">
    <!-- ★ DB의 mem_code → VO의 memCode 로 매핑 -->
    <result property="memCode"  column="mem_code"/>
    <result property="memId"    column="mem_id"/>
    <result property="memPwd"   column="mem_pwd"/>
    <result property="nickname" column="nickname"/>
    <result property="email"    column="email"/>
    <result property="joinDate" column="joindate"/>
  </resultMap>

  <!-- 아이디 중복 체크 -->
  <select id="selectOverlappedID" parameterType="string" resultType="int">
    SELECT COUNT(1)
    FROM t_member
    WHERE mem_id = #{id}
  </select>

  <!-- 전체 목록 -->
  <select id="selectAllMemberList" resultMap="memResult">
    <![CDATA[
      SELECT
        mem_code,                 -- ★ 포함
        mem_id, mem_pwd, nickname, email, joindate
      FROM t_member
      ORDER BY joindate DESC
    ]]>
  </select>

  <!-- 회원 추가: joindate는 DB NOW() -->
  <insert id="insertMember" parameterType="com.myspring.vampir.member.vo.MemberVO">
    <![CDATA[
      INSERT INTO t_member (mem_id, mem_pwd, nickname, email, joindate)
      VALUES (#{memId}, #{memPwd}, #{nickname}, #{email}, NOW())
    ]]>
  </insert>

  <!-- 회원 수정 -->
  <update id="updateMember" parameterType="com.myspring.vampir.member.vo.MemberVO">
    <![CDATA[
      UPDATE t_member
      SET
        mem_pwd = #{memPwd},
        nickname = #{nickname},
        email    = #{email}
      WHERE mem_id = #{memId}
    ]]>
  </update>

  <!-- 회원 삭제 (단일 문자열 파라미터) -->
  <delete id="deleteMember" parameterType="string">
    <![CDATA[
      DELETE FROM t_member
      WHERE mem_id = #{value}
    ]]>
  </delete>

  <!-- 로그인: ★ mem_code 반드시 포함 -->
  <select id="loginById"
          parameterType="com.myspring.vampir.member.vo.MemberVO"
          resultMap="memResult">
    <![CDATA[
      SELECT
        mem_code,                 -- ★ 반드시 포함
        mem_id, mem_pwd, nickname, email, joindate
      FROM t_member
      WHERE mem_id = #{memId}
        AND mem_pwd = #{memPwd}
      LIMIT 1
    ]]>
  </select>

  <!-- (최후 보루용) mem_id로 mem_code만 단건 조회 -->
  <select id="selectMemCodeByMemId" parameterType="string" resultType="int">
    <![CDATA[
      SELECT mem_code
      FROM t_member
      WHERE mem_id = #{value}     -- ★ parameterType=string이면 #{value}가 안전
      LIMIT 1
    ]]>
  </select>

</mapper>
